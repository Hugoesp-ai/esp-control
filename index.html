<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ESP32 Greenhouse</title>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  display:flex;
  justify-content:center;
}

.card{
  background:#111;
  padding:20px;
  border-radius:20px;
  margin-top:20px;
  width:340px;
  text-align:center;
}

.state{margin:8px;font-size:18px}

button{
  padding:12px;
  margin:5px;
  border:none;
  border-radius:10px;
  color:white;
  font-size:16px;
  cursor:pointer;
}

.on{background:#00aa55}
.off{background:#cc3333}
.calib{background:gold;color:black}
.calibActive{background:red;color:white}

</style>
</head>

<body>

<div class="card">

<h2>ğŸŒ± Greenhouse</h2>
  
<div class="state"> vent : 12km/H</div>
<div class="state">ğŸŒ¡ Temp : <span id="temp">--</span> Â°C</div>
<div class="state">ğŸ’§ HumiditÃ© : <span id="hum">--</span> %</div>
<div class="state">ğŸŒ± Sol : <span id="soil">--</span> %</div>
<div class="state">ğŸ« COâ‚‚ : <span id="co2">--</span> ppm</div>
<div class="state">ğŸŒ LumiÃ¨re : <span id="light">--</span></div>

<hr>

<h3>Relais</h3>

<button onclick="send('esp32/remplissage/cmd','ON')" class="on">Remplissage ON</button>
<button onclick="send('esp32/remplissage/cmd','OFF')" class="off">OFF</button><br>

<button onclick="send('esp32/pompe/cmd','ON')" class="on">Pompe ON</button>
<button onclick="send('esp32/pompe/cmd','OFF')" class="off">OFF</button><br>

<button onclick="send('esp32/brassage/cmd','ON')" class="on">Brassage ON</button>
<button onclick="send('esp32/brassage/cmd','OFF')" class="off">OFF</button><br>

<button onclick="send('esp32/arrosage/cmd','ON')" class="on">Arrosage ON</button>
<button onclick="send('esp32/arrosage/cmd','OFF')" class="off">OFF</button>

<hr>

<button id="calibBtn" class="calib" onclick="toggleCalib()">
Calibration COâ‚‚
</button>

</div>

<script>
const client = mqtt.connect(
"wss://92fa7388d5834bffa514b462e7b817fa.s1.eu.hivemq.cloud:8884/mqtt",
{
 username:"Hugoesp",
 password:"Kikoloki1"
});

client.on("connect",()=>{
 client.subscribe("esp32/#");
});

function send(topic,msg){
 client.publish(topic,msg);
}

let calib=false;

function toggleCalib(){
 calib=!calib;
 let btn=document.getElementById("calibBtn");

 if(calib){
   btn.className="calibActive";
   client.publish("esp32/co2/calibrate","START");
 }else{
   btn.className="calib";
   client.publish("esp32/co2/calibrate","STOP");
 }
}

client.on("message",(topic,msg)=>{
 let v=msg.toString();

 if(topic=="esp32/temp") temp.innerText=v;
 if(topic=="esp32/hum") hum.innerText=v;
 if(topic=="esp32/soil") soil.innerText=v;
 if(topic=="esp32/co2") co2.innerText=v;

 if(topic=="esp32/light"){
   light.innerText=v;
   light.style.color=(v=="DAY")?"yellow":"lightblue";
 }
});
</script>

</body>
</html>
